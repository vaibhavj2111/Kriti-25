"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Jt=require("detect-browser"),D=require("@walletconnect/time"),C=require("@walletconnect/window-getters"),Wt=require("@walletconnect/window-metadata"),Re=require("@ethersproject/hash"),zt=require("@ethersproject/transactions"),Te=require("@stablelib/chacha20poly1305"),Yt=require("@stablelib/hkdf"),B=require("@stablelib/random"),H=require("@stablelib/sha256"),Gt=require("@stablelib/x25519"),p=require("uint8arrays"),Qt=require("elliptic"),Zt=require("@walletconnect/relay-auth"),Xt=require("@walletconnect/relay-api");function en(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach(function(n){if(n!=="default"){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}}),t.default=e,Object.freeze(t)}var Ae=en(Gt);const J=":";function te(e){const[t,n]=e.split(J);return{namespace:t,reference:n}}function Ie(e){const{namespace:t,reference:n}=e;return[t,n].join(J)}function ne(e){const[t,n,r]=e.split(J);return{namespace:t,reference:n,address:r}}function Pe(e){const{namespace:t,reference:n,address:r}=e;return[t,n,r].join(J)}function re(e,t){const n=[];return e.forEach(r=>{const o=t(r);n.includes(o)||n.push(o)}),n}function Ce(e){const{address:t}=ne(e);return t}function je(e){const{namespace:t,reference:n}=ne(e);return Ie({namespace:t,reference:n})}function tn(e,t){const{namespace:n,reference:r}=te(t);return Pe({namespace:n,reference:r,address:e})}function nn(e){return re(e,Ce)}function $e(e){return re(e,je)}function rn(e,t=[]){const n=[];return Object.keys(e).forEach(r=>{if(t.length&&!t.includes(r))return;const o=e[r];n.push(...o.accounts)}),n}function on(e,t=[]){const n=[];return Object.keys(e).forEach(r=>{if(t.length&&!t.includes(r))return;const o=e[r];n.push(...$e(o.accounts))}),n}function sn(e,t=[]){const n=[];return Object.keys(e).forEach(r=>{if(t.length&&!t.includes(r))return;const o=e[r];n.push(...W(r,o))}),n}function W(e,t){return e.includes(":")?[e]:t.chains||[]}const Ue="ReactNative",y={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},z=" ",an=":",_e="/",oe=2,cn=1e3,De="js";function se(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function O(){return!C.getDocument()&&!!C.getNavigator()&&navigator.product===Ue}function un(){return O()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function ln(){return O()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function M(){return!se()&&!!C.getNavigator()&&!!C.getDocument()}function j(){return O()?y.reactNative:se()?y.node:M()?y.browser:y.unknown}function dn(){var e;try{return O()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(e=global.Application)==null?void 0:e.applicationId:void 0}catch{return}}function Ve(e,t){const n=new URLSearchParams(e);for(const r of Object.keys(t).sort())if(t.hasOwnProperty(r)){const o=t[r];o!==void 0&&n.set(r,o)}return n.toString()}function pn(){return Wt.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function fn(e,t){var n;const r=j(),o={protocol:e,version:t,env:r};return r==="browser"&&(o.host=((n=C.getLocation())==null?void 0:n.host)||"unknown"),o}function ke(){if(j()===y.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:n,Version:r}=global.Platform;return[n,r].join("-")}const e=Jt.detect();if(e===null)return"unknown";const t=e.os?e.os.replace(" ","").toLowerCase():"unknown";return e.type==="browser"?[t,e.name,e.version].join("-"):[t,e.version].join("-")}function xe(){var e;const t=j();return t===y.browser?[t,((e=C.getLocation())==null?void 0:e.host)||"unknown"].join(":"):t}function Me(e,t,n){const r=ke(),o=xe();return[[e,t].join("-"),[De,n].join("-"),r,o].join("/")}function mn({protocol:e,version:t,relayUrl:n,sdkVersion:r,auth:o,projectId:s,useOnCloseEvent:a,bundleId:c,packageName:d}){const i=n.split("?"),l=Me(e,t,r),u={auth:o,ua:l,projectId:s,useOnCloseEvent:a||void 0,packageName:d||void 0,bundleId:c||void 0},f=Ve(i[1]||"",u);return i[0]+"?"+f}function gn(e){let t=(e.match(/^[^:]+(?=:\/\/)/gi)||[])[0];const n=typeof t<"u"?e.split("://")[1]:e;return t=t==="wss"?"https":"http",[t,n].join("://")}function hn(e,t,n){if(!e[t]||typeof e[t]!==n)throw new Error(`Missing or invalid "${t}" param`)}function Le(e,t=oe){return Fe(e.split(_e),t)}function yn(e){return Le(e).join(z)}function R(e,t){return e.filter(n=>t.includes(n)).length===e.length}function Fe(e,t=oe){return e.slice(Math.max(e.length-t,0))}function vn(e){return Object.fromEntries(e.entries())}function En(e){return new Map(Object.entries(e))}function bn(e,t){const n={};return Object.keys(e).forEach(r=>{n[r]=t(e[r])}),n}const Nn=e=>e;function Ke(e){return e.trim().replace(/^\w/,t=>t.toUpperCase())}function Sn(e){return e.split(z).map(t=>Ke(t)).join(z)}function wn(e=D.FIVE_MINUTES,t){const n=D.toMiliseconds(e||D.FIVE_MINUTES);let r,o,s,a;return{resolve:c=>{s&&r&&(clearTimeout(s),r(c),a=Promise.resolve(c))},reject:c=>{s&&o&&(clearTimeout(s),o(c))},done:()=>new Promise((c,d)=>{if(a)return c(a);s=setTimeout(()=>{const i=new Error(t);a=Promise.reject(i),d(i)},n),r=c,o=d})}}function On(e,t,n){return new Promise(async(r,o)=>{const s=setTimeout(()=>o(new Error(n)),t);try{const a=await e;r(a)}catch(a){o(a)}clearTimeout(s)})}function ie(e,t){if(typeof t=="string"&&t.startsWith(`${e}:`))return t;if(e.toLowerCase()==="topic"){if(typeof t!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${t}`}else if(e.toLowerCase()==="id"){if(typeof t!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${t}`}throw new Error(`Unknown expirer target type: ${e}`)}function Rn(e){return ie("topic",e)}function Tn(e){return ie("id",e)}function An(e){const[t,n]=e.split(":"),r={id:void 0,topic:void 0};if(t==="topic"&&typeof n=="string")r.topic=n;else if(t==="id"&&Number.isInteger(Number(n)))r.id=Number(n);else throw new Error(`Invalid target, expected id:number or topic:string, got ${t}:${n}`);return r}function In(e,t){return D.fromMiliseconds((t||Date.now())+D.toMiliseconds(e))}function Pn(e){return Date.now()>=D.toMiliseconds(e)}function Cn(e,t){return`${e}${t?`:${t}`:""}`}function S(e=[],t=[]){return[...new Set([...e,...t])]}async function jn({id:e,topic:t,wcDeepLink:n}){var r;try{if(!n)return;const o=typeof n=="string"?JSON.parse(n):n,s=o?.href;if(typeof s!="string")return;const a=qe(s,e,t),c=j();if(c===y.browser){if(!((r=C.getDocument())!=null&&r.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}Be(a)}else c===y.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(a)}catch(o){console.error(o)}}function qe(e,t,n){const r=`requestId=${t}&sessionTopic=${n}`;e.endsWith("/")&&(e=e.slice(0,-1));let o=`${e}`;if(e.startsWith("https://t.me")){const s=e.includes("?")?"&startapp=":"?startapp=";o=`${o}${s}${We(r,!0)}`}else o=`${o}/wc?${r}`;return o}function Be(e){let t="_self";Je()?t="_top":(He()||e.startsWith("https://")||e.startsWith("http://"))&&(t="_blank"),window.open(e,t,"noreferrer noopener")}async function $n(e,t){let n="";try{if(M()&&(n=localStorage.getItem(t),n))return n;n=await e.getItem(t)}catch(r){console.error(r)}return n}function ae(e,t){return e.filter(n=>t.includes(n))}function Un(e,t){if(!e.includes(t))return null;const n=e.split(/([&,?,=])/),r=n.indexOf(t);return n[r+2]}function _n(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,e=>{const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}function Dn(){return typeof process<"u"&&process.env.IS_VITEST==="true"}function He(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function Je(){try{return window.self!==window.top}catch{return!1}}function We(e,t=!1){const n=Buffer.from(e).toString("base64");return t?n.replace(/[=]/g,""):n}function ce(e){return Buffer.from(e,"base64").toString("utf-8")}function Vn(e){return new Promise(t=>setTimeout(t,e))}const kn="https://rpc.walletconnect.org/v1";async function ze(e,t,n,r,o,s){switch(n.t){case"eip191":return Ye(e,t,n.s);case"eip1271":return await Ge(e,t,n.s,r,o,s);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${n.t}`)}}function Ye(e,t,n){return zt.recoverAddress(Re.hashMessage(t),n).toLowerCase()===e.toLowerCase()}async function Ge(e,t,n,r,o,s){const a=te(r);if(!a.namespace||!a.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${r}`);try{const c="0x1626ba7e",d="0000000000000000000000000000000000000000000000000000000000000040",i="0000000000000000000000000000000000000000000000000000000000000041",l=n.substring(2),u=Re.hashMessage(t).substring(2),f=c+u+d+i+l,h=await fetch(`${s||kn}/?chainId=${r}&projectId=${o}`,{method:"POST",body:JSON.stringify({id:xn(),jsonrpc:"2.0",method:"eth_call",params:[{to:e,data:f},"latest"]})}),{result:m}=await h.json();return m?m.slice(0,c.length).toLowerCase()===c.toLowerCase():!1}catch(c){return console.error("isValidEip1271Signature: ",c),!1}}function xn(){return Date.now()+Math.floor(Math.random()*1e3)}var Mn=Object.defineProperty,Ln=Object.defineProperties,Fn=Object.getOwnPropertyDescriptors,Qe=Object.getOwnPropertySymbols,Kn=Object.prototype.hasOwnProperty,qn=Object.prototype.propertyIsEnumerable,Ze=(e,t,n)=>t in e?Mn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ue=(e,t)=>{for(var n in t||(t={}))Kn.call(t,n)&&Ze(e,n,t[n]);if(Qe)for(var n of Qe(t))qn.call(t,n)&&Ze(e,n,t[n]);return e},Xe=(e,t)=>Ln(e,Fn(t));const Bn="did:pkh:",Y=e=>e?.split(":"),et=e=>{const t=e&&Y(e);if(t)return e.includes(Bn)?t[3]:t[1]},tt=e=>{const t=e&&Y(e);if(t)return t[2]+":"+t[3]},le=e=>{const t=e&&Y(e);if(t)return t.pop()};async function Hn(e){const{cacao:t,projectId:n}=e,{s:r,p:o}=t,s=nt(o,o.iss),a=le(o.iss);return await ze(a,s,r,tt(o.iss),n)}const nt=(e,t)=>{const n=`${e.domain} wants you to sign in with your Ethereum account:`,r=le(t);if(!e.aud&&!e.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let o=e.statement||void 0;const s=`URI: ${e.aud||e.uri}`,a=`Version: ${e.version}`,c=`Chain ID: ${et(t)}`,d=`Nonce: ${e.nonce}`,i=`Issued At: ${e.iat}`,l=e.exp?`Expiration Time: ${e.exp}`:void 0,u=e.nbf?`Not Before: ${e.nbf}`:void 0,f=e.requestId?`Request ID: ${e.requestId}`:void 0,h=e.resources?`Resources:${e.resources.map(g=>`
- ${g}`).join("")}`:void 0,m=Q(e.resources);if(m){const g=T(m);o=fe(o,g)}return[n,r,"",o,"",s,a,c,d,i,l,u,f,h].filter(g=>g!=null).join(`
`)};function Jn(e,t,n){return n.includes("did:pkh:")||(n=`did:pkh:${n}`),{h:{t:"caip122"},p:{iss:n,domain:e.domain,aud:e.aud,version:e.version,nonce:e.nonce,iat:e.iat,statement:e.statement,requestId:e.requestId,resources:e.resources,nbf:e.nbf,exp:e.exp},s:t}}function Wn(e){var t;const{authPayload:n,chains:r,methods:o}=e,s=n.statement||"";if(!(r!=null&&r.length))return n;const a=n.chains,c=ae(a,r);if(!(c!=null&&c.length))throw new Error("No supported chains");const d=rt(n.resources);if(!d)return n;N(d);const i=ot(d,"eip155");let l=n?.resources||[];if(i!=null&&i.length){const u=st(i),f=ae(u,o);if(!(f!=null&&f.length))throw new Error(`Supported methods don't satisfy the requested: ${JSON.stringify(u)}, supported: ${JSON.stringify(o)}`);const h=de("request",f,{chains:c}),m=ut(d,"eip155",h);l=((t=n?.resources)==null?void 0:t.slice(0,-1))||[],l.push(G(m))}return Xe(ue({},n),{statement:dt(s,Q(l)),chains:c,resources:n!=null&&n.resources||l.length>0?l:void 0})}function rt(e){const t=Q(e);if(t&&pe(t))return T(t)}function zn(e,t){var n;return(n=e?.att)==null?void 0:n.hasOwnProperty(t)}function ot(e,t){var n,r;return(n=e?.att)!=null&&n[t]?Object.keys((r=e?.att)==null?void 0:r[t]):[]}function Yn(e){return e?.map(t=>Object.keys(t))||[]}function st(e){return e?.map(t=>{var n;return(n=t.split("/"))==null?void 0:n[1]})||[]}function it(e){return Buffer.from(JSON.stringify(e)).toString("base64")}function at(e){return JSON.parse(Buffer.from(e,"base64").toString("utf-8"))}function N(e){if(!e)throw new Error("No recap provided, value is undefined");if(!e.att)throw new Error("No `att` property found");const t=Object.keys(e.att);if(!(t!=null&&t.length))throw new Error("No resources found in `att` property");t.forEach(n=>{const r=e.att[n];if(Array.isArray(r))throw new Error(`Resource must be an object: ${n}`);if(typeof r!="object")throw new Error(`Resource must be an object: ${n}`);if(!Object.keys(r).length)throw new Error(`Resource object is empty: ${n}`);Object.keys(r).forEach(o=>{const s=r[o];if(!Array.isArray(s))throw new Error(`Ability limits ${o} must be an array of objects, found: ${s}`);if(!s.length)throw new Error(`Value of ${o} is empty array, must be an array with objects`);s.forEach(a=>{if(typeof a!="object")throw new Error(`Ability limits (${o}) must be an array of objects, found: ${a}`)})})})}function ct(e,t,n,r={}){return n?.sort((o,s)=>o.localeCompare(s)),{att:{[e]:de(t,n,r)}}}function ut(e,t,n){var r;return e.att[t]=ue({},n),((r=Object.keys(e.att))==null?void 0:r.sort((o,s)=>o.localeCompare(s))).reduce((o,s)=>(o.att[s]=e.att[s],o),{att:{}})}function de(e,t,n={}){t=t?.sort((o,s)=>o.localeCompare(s));const r=t.map(o=>({[`${e}/${o}`]:[n]}));return Object.assign({},...r)}function G(e){return N(e),`urn:recap:${it(e).replace(/=/g,"")}`}function T(e){const t=at(e.replace("urn:recap:",""));return N(t),t}function Gn(e,t,n){const r=ct(e,t,n);return G(r)}function pe(e){return e&&e.includes("urn:recap:")}function Qn(e,t){const n=T(e),r=T(t),o=lt(n,r);return G(o)}function lt(e,t){N(e),N(t);const n=Object.keys(e.att).concat(Object.keys(t.att)).sort((o,s)=>o.localeCompare(s)),r={att:{}};return n.forEach(o=>{var s,a;Object.keys(((s=e.att)==null?void 0:s[o])||{}).concat(Object.keys(((a=t.att)==null?void 0:a[o])||{})).sort((c,d)=>c.localeCompare(d)).forEach(c=>{var d,i;r.att[o]=Xe(ue({},r.att[o]),{[c]:((d=e.att[o])==null?void 0:d[c])||((i=t.att[o])==null?void 0:i[c])})})}),r}function fe(e="",t){N(t);const n="I further authorize the stated URI to perform the following actions on my behalf: ";if(e.includes(n))return e;const r=[];let o=0;Object.keys(t.att).forEach(c=>{const d=Object.keys(t.att[c]).map(u=>({ability:u.split("/")[0],action:u.split("/")[1]}));d.sort((u,f)=>u.action.localeCompare(f.action));const i={};d.forEach(u=>{i[u.ability]||(i[u.ability]=[]),i[u.ability].push(u.action)});const l=Object.keys(i).map(u=>(o++,`(${o}) '${u}': '${i[u].join("', '")}' for '${c}'.`));r.push(l.join(", ").replace(".,","."))});const s=r.join(" "),a=`${n}${s}`;return`${e?e+" ":""}${a}`}function Zn(e){var t;const n=T(e);N(n);const r=(t=n.att)==null?void 0:t.eip155;return r?Object.keys(r).map(o=>o.split("/")[1]):[]}function Xn(e){const t=T(e);N(t);const n=[];return Object.values(t.att).forEach(r=>{Object.values(r).forEach(o=>{var s;(s=o?.[0])!=null&&s.chains&&n.push(o[0].chains)})}),[...new Set(n.flat())]}function dt(e,t){if(!t)return e;const n=T(t);return N(n),fe(e,n)}function Q(e){if(!e)return;const t=e?.[e.length-1];return pe(t)?t:void 0}const me="base10",v="base16",ge="base64pad",er="base64url",V="utf8",he=0,k=1,L=2,tr=0,pt=1,F=12,ye=32;function nr(){const e=Ae.generateKeyPair();return{privateKey:p.toString(e.secretKey,v),publicKey:p.toString(e.publicKey,v)}}function rr(){const e=B.randomBytes(ye);return p.toString(e,v)}function or(e,t){const n=Ae.sharedKey(p.fromString(e,v),p.fromString(t,v),!0),r=new Yt.HKDF(H.SHA256,n).expand(ye);return p.toString(r,v)}function sr(e){const t=H.hash(p.fromString(e,v));return p.toString(t,v)}function ir(e){const t=H.hash(p.fromString(e,V));return p.toString(t,v)}function ve(e){return p.fromString(`${e}`,me)}function $(e){return Number(p.toString(e,me))}function ar(e){const t=ve(typeof e.type<"u"?e.type:he);if($(t)===k&&typeof e.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const n=typeof e.senderPublicKey<"u"?p.fromString(e.senderPublicKey,v):void 0,r=typeof e.iv<"u"?p.fromString(e.iv,v):B.randomBytes(F),o=new Te.ChaCha20Poly1305(p.fromString(e.symKey,v)).seal(r,p.fromString(e.message,V));return Ee({type:t,sealed:o,iv:r,senderPublicKey:n,encoding:e.encoding})}function cr(e,t){const n=ve(L),r=B.randomBytes(F),o=p.fromString(e,V);return Ee({type:n,sealed:o,iv:r,encoding:t})}function ur(e){const t=new Te.ChaCha20Poly1305(p.fromString(e.symKey,v)),{sealed:n,iv:r}=Z({encoded:e.encoded,encoding:e?.encoding}),o=t.open(r,n);if(o===null)throw new Error("Failed to decrypt");return p.toString(o,V)}function lr(e,t){const{sealed:n}=Z({encoded:e,encoding:t});return p.toString(n,V)}function Ee(e){const{encoding:t=ge}=e;if($(e.type)===L)return p.toString(p.concat([e.type,e.sealed]),t);if($(e.type)===k){if(typeof e.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return p.toString(p.concat([e.type,e.senderPublicKey,e.iv,e.sealed]),t)}return p.toString(p.concat([e.type,e.iv,e.sealed]),t)}function Z(e){const{encoded:t,encoding:n=ge}=e,r=p.fromString(t,n),o=r.slice(tr,pt),s=pt;if($(o)===k){const i=s+ye,l=i+F,u=r.slice(s,i),f=r.slice(i,l),h=r.slice(l);return{type:o,sealed:h,iv:f,senderPublicKey:u}}if($(o)===L){const i=r.slice(s),l=B.randomBytes(F);return{type:o,sealed:i,iv:l}}const a=s+F,c=r.slice(s,a),d=r.slice(a);return{type:o,sealed:d,iv:c}}function dr(e,t){const n=Z({encoded:e,encoding:t?.encoding});return ft({type:$(n.type),senderPublicKey:typeof n.senderPublicKey<"u"?p.toString(n.senderPublicKey,v):void 0,receiverPublicKey:t?.receiverPublicKey})}function ft(e){const t=e?.type||he;if(t===k){if(typeof e?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof e?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:t,senderPublicKey:e?.senderPublicKey,receiverPublicKey:e?.receiverPublicKey}}function pr(e){return e.type===k&&typeof e.senderPublicKey=="string"&&typeof e.receiverPublicKey=="string"}function fr(e){return e.type===L}function mt(e){return new Qt.ec("p256").keyFromPublic({x:Buffer.from(e.x,"base64").toString("hex"),y:Buffer.from(e.y,"base64").toString("hex")},"hex")}function mr(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");const n=t.length%4;return n>0&&(t+="=".repeat(4-n)),t}function gr(e){return Buffer.from(mr(e),"base64")}function hr(e,t){const[n,r,o]=e.split("."),s=gr(o);if(s.length!==64)throw new Error("Invalid signature length");const a=s.slice(0,32).toString("hex"),c=s.slice(32,64).toString("hex"),d=`${n}.${r}`,i=new H.SHA256().update(Buffer.from(d)).digest(),l=mt(t),u=Buffer.from(i).toString("hex");if(!l.verify(u,{r:a,s:c}))throw new Error("Invalid signature");return Zt.decodeJWT(e).payload}const gt="irn";function yr(e){return e?.relay||{protocol:gt}}function vr(e){const t=Xt.RELAY_JSONRPC[e];if(typeof t>"u")throw new Error(`Relay Protocol not supported: ${e}`);return t}function ht(e,t="-"){const n={},r="relay"+t;return Object.keys(e).forEach(o=>{if(o.startsWith(r)){const s=o.replace(r,""),a=e[o];n[s]=a}}),n}function Er(e){if(!e.includes("wc:")){const i=ce(e);i!=null&&i.includes("wc:")&&(e=i)}e=e.includes("wc://")?e.replace("wc://",""):e,e=e.includes("wc:")?e.replace("wc:",""):e;const t=e.indexOf(":"),n=e.indexOf("?")!==-1?e.indexOf("?"):void 0,r=e.substring(0,t),o=e.substring(t+1,n).split("@"),s=typeof n<"u"?e.substring(n):"",a=new URLSearchParams(s),c={};a.forEach((i,l)=>{c[l]=i});const d=typeof c.methods=="string"?c.methods.split(","):void 0;return{protocol:r,topic:yt(o[0]),version:parseInt(o[1],10),symKey:c.symKey,relay:ht(c),methods:d,expiryTimestamp:c.expiryTimestamp?parseInt(c.expiryTimestamp,10):void 0}}function yt(e){return e.startsWith("//")?e.substring(2):e}function vt(e,t="-"){const n="relay",r={};return Object.keys(e).forEach(o=>{const s=n+t+o;e[o]&&(r[s]=e[o])}),r}function br(e){const t=new URLSearchParams,n=vt(e.relay);Object.keys(n).sort().forEach(o=>{t.set(o,n[o])}),t.set("symKey",e.symKey),e.expiryTimestamp&&t.set("expiryTimestamp",e.expiryTimestamp.toString()),e.methods&&t.set("methods",e.methods.join(","));const r=t.toString();return`${e.protocol}:${e.topic}@${e.version}?${r}`}function Nr(e,t,n){return`${e}?wc_ev=${n}&topic=${t}`}var Sr=Object.defineProperty,wr=Object.defineProperties,Or=Object.getOwnPropertyDescriptors,Et=Object.getOwnPropertySymbols,Rr=Object.prototype.hasOwnProperty,Tr=Object.prototype.propertyIsEnumerable,bt=(e,t,n)=>t in e?Sr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ar=(e,t)=>{for(var n in t||(t={}))Rr.call(t,n)&&bt(e,n,t[n]);if(Et)for(var n of Et(t))Tr.call(t,n)&&bt(e,n,t[n]);return e},Ir=(e,t)=>wr(e,Or(t));function U(e){const t=[];return e.forEach(n=>{const[r,o]=n.split(":");t.push(`${r}:${o}`)}),t}function Nt(e){const t=[];return Object.values(e).forEach(n=>{t.push(...U(n.accounts))}),t}function St(e,t){const n=[];return Object.values(e).forEach(r=>{U(r.accounts).includes(t)&&n.push(...r.methods)}),n}function wt(e,t){const n=[];return Object.values(e).forEach(r=>{U(r.accounts).includes(t)&&n.push(...r.events)}),n}function Pr(e,t){const n=_t(e,t);if(n)throw new Error(n.message);const r={};for(const[o,s]of Object.entries(e))r[o]={methods:s.methods,events:s.events,chains:s.accounts.map(a=>`${a.split(":")[0]}:${a.split(":")[1]}`)};return r}function Cr(e){const{proposal:{requiredNamespaces:t,optionalNamespaces:n={}},supportedNamespaces:r}=e,o=Ne(t),s=Ne(n),a={};Object.keys(r).forEach(i=>{const l=r[i].chains,u=r[i].methods,f=r[i].events,h=r[i].accounts;l.forEach(m=>{if(!h.some(g=>g.includes(m)))throw new Error(`No accounts provided for chain ${m} in namespace ${i}`)}),a[i]={chains:l,methods:u,events:f,accounts:h}});const c=Vt(t,a,"approve()");if(c)throw new Error(c.message);const d={};return!Object.keys(t).length&&!Object.keys(n).length?a:(Object.keys(o).forEach(i=>{const l=r[i].chains.filter(m=>{var g,b;return(b=(g=o[i])==null?void 0:g.chains)==null?void 0:b.includes(m)}),u=r[i].methods.filter(m=>{var g,b;return(b=(g=o[i])==null?void 0:g.methods)==null?void 0:b.includes(m)}),f=r[i].events.filter(m=>{var g,b;return(b=(g=o[i])==null?void 0:g.events)==null?void 0:b.includes(m)}),h=l.map(m=>r[i].accounts.filter(g=>g.includes(`${m}:`))).flat();d[i]={chains:l,methods:u,events:f,accounts:h}}),Object.keys(s).forEach(i=>{var l,u,f,h,m,g;if(!r[i])return;const b=(u=(l=s[i])==null?void 0:l.chains)==null?void 0:u.filter(I=>r[i].chains.includes(I)),qt=r[i].methods.filter(I=>{var P,x;return(x=(P=s[i])==null?void 0:P.methods)==null?void 0:x.includes(I)}),Bt=r[i].events.filter(I=>{var P,x;return(x=(P=s[i])==null?void 0:P.events)==null?void 0:x.includes(I)}),Ht=b?.map(I=>r[i].accounts.filter(P=>P.includes(`${I}:`))).flat();d[i]={chains:S((f=d[i])==null?void 0:f.chains,b),methods:S((h=d[i])==null?void 0:h.methods,qt),events:S((m=d[i])==null?void 0:m.events,Bt),accounts:S((g=d[i])==null?void 0:g.accounts,Ht)}}),d)}function be(e){return e.includes(":")}function Ot(e){return be(e)?e.split(":")[0]:e}function Ne(e){var t,n,r;const o={};if(!X(e))return o;for(const[s,a]of Object.entries(e)){const c=be(s)?[s]:a.chains,d=a.methods||[],i=a.events||[],l=Ot(s);o[l]=Ir(Ar({},o[l]),{chains:S(c,(t=o[l])==null?void 0:t.chains),methods:S(d,(n=o[l])==null?void 0:n.methods),events:S(i,(r=o[l])==null?void 0:r.events)})}return o}function Rt(e){const t={};return e?.forEach(n=>{const[r,o]=n.split(":");t[r]||(t[r]={accounts:[],chains:[],events:[]}),t[r].accounts.push(n),t[r].chains.push(`${r}:${o}`)}),t}function jr(e,t){t=t.map(r=>r.replace("did:pkh:",""));const n=Rt(t);for(const[r,o]of Object.entries(n))o.methods?o.methods=S(o.methods,e):o.methods=e,o.events=["chainChanged","accountsChanged"];return n}const Tt={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},At={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function w(e,t){const{message:n,code:r}=At[e];return{message:t?`${n} ${t}`:n,code:r}}function _(e,t){const{message:n,code:r}=Tt[e];return{message:t?`${n} ${t}`:n,code:r}}function K(e,t){return Array.isArray(e)?typeof t<"u"&&e.length?e.every(t):!0:!1}function X(e){return Object.getPrototypeOf(e)===Object.prototype&&Object.keys(e).length}function A(e){return typeof e>"u"}function E(e,t){return t&&A(e)?!0:typeof e=="string"&&!!e.trim().length}function ee(e,t){return t&&A(e)?!0:typeof e=="number"&&!isNaN(e)}function $r(e,t){const{requiredNamespaces:n}=t,r=Object.keys(e.namespaces),o=Object.keys(n);let s=!0;return R(o,r)?(r.forEach(a=>{const{accounts:c,methods:d,events:i}=e.namespaces[a],l=U(c),u=n[a];(!R(W(a,u),l)||!R(u.methods,d)||!R(u.events,i))&&(s=!1)}),s):!1}function q(e){return E(e,!1)&&e.includes(":")?e.split(":").length===2:!1}function It(e){if(E(e,!1)&&e.includes(":")){const t=e.split(":");if(t.length===3){const n=t[0]+":"+t[1];return!!t[2]&&q(n)}}return!1}function Ur(e){function t(n){try{return typeof new URL(n)<"u"}catch{return!1}}try{if(E(e,!1)){if(t(e))return!0;const n=ce(e);return t(n)}}catch{}return!1}function _r(e){var t;return(t=e?.proposer)==null?void 0:t.publicKey}function Dr(e){return e?.topic}function Vr(e,t){let n=null;return E(e?.publicKey,!1)||(n=w("MISSING_OR_INVALID",`${t} controller public key should be a string`)),n}function Se(e){let t=!0;return K(e)?e.length&&(t=e.every(n=>E(n,!1))):t=!1,t}function Pt(e,t,n){let r=null;return K(t)&&t.length?t.forEach(o=>{r||q(o)||(r=_("UNSUPPORTED_CHAINS",`${n}, chain ${o} should be a string and conform to "namespace:chainId" format`))}):q(e)||(r=_("UNSUPPORTED_CHAINS",`${n}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),r}function Ct(e,t,n){let r=null;return Object.entries(e).forEach(([o,s])=>{if(r)return;const a=Pt(o,W(o,s),`${t} ${n}`);a&&(r=a)}),r}function jt(e,t){let n=null;return K(e)?e.forEach(r=>{n||It(r)||(n=_("UNSUPPORTED_ACCOUNTS",`${t}, account ${r} should be a string and conform to "namespace:chainId:address" format`))}):n=_("UNSUPPORTED_ACCOUNTS",`${t}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),n}function $t(e,t){let n=null;return Object.values(e).forEach(r=>{if(n)return;const o=jt(r?.accounts,`${t} namespace`);o&&(n=o)}),n}function Ut(e,t){let n=null;return Se(e?.methods)?Se(e?.events)||(n=_("UNSUPPORTED_EVENTS",`${t}, events should be an array of strings or empty array for no events`)):n=_("UNSUPPORTED_METHODS",`${t}, methods should be an array of strings or empty array for no methods`),n}function we(e,t){let n=null;return Object.values(e).forEach(r=>{if(n)return;const o=Ut(r,`${t}, namespace`);o&&(n=o)}),n}function kr(e,t,n){let r=null;if(e&&X(e)){const o=we(e,t);o&&(r=o);const s=Ct(e,t,n);s&&(r=s)}else r=w("MISSING_OR_INVALID",`${t}, ${n} should be an object with data`);return r}function _t(e,t){let n=null;if(e&&X(e)){const r=we(e,t);r&&(n=r);const o=$t(e,t);o&&(n=o)}else n=w("MISSING_OR_INVALID",`${t}, namespaces should be an object with data`);return n}function Dt(e){return E(e.protocol,!0)}function xr(e,t){let n=!1;return t&&!e?n=!0:e&&K(e)&&e.length&&e.forEach(r=>{n=Dt(r)}),n}function Mr(e){return typeof e=="number"}function Lr(e){return typeof e<"u"&&typeof e!==null}function Fr(e){return!(!e||typeof e!="object"||!e.code||!ee(e.code,!1)||!e.message||!E(e.message,!1))}function Kr(e){return!(A(e)||!E(e.method,!1))}function qr(e){return!(A(e)||A(e.result)&&A(e.error)||!ee(e.id,!1)||!E(e.jsonrpc,!1))}function Br(e){return!(A(e)||!E(e.name,!1))}function Hr(e,t){return!(!q(t)||!Nt(e).includes(t))}function Jr(e,t,n){return E(n,!1)?St(e,t).includes(n):!1}function Wr(e,t,n){return E(n,!1)?wt(e,t).includes(n):!1}function Vt(e,t,n){let r=null;const o=zr(e),s=Yr(t),a=Object.keys(o),c=Object.keys(s),d=kt(Object.keys(e)),i=kt(Object.keys(t)),l=d.filter(u=>!i.includes(u));return l.length&&(r=w("NON_CONFORMING_NAMESPACES",`${n} namespaces keys don't satisfy requiredNamespaces.
      Required: ${l.toString()}
      Received: ${Object.keys(t).toString()}`)),R(a,c)||(r=w("NON_CONFORMING_NAMESPACES",`${n} namespaces chains don't satisfy required namespaces.
      Required: ${a.toString()}
      Approved: ${c.toString()}`)),Object.keys(t).forEach(u=>{if(!u.includes(":")||r)return;const f=U(t[u].accounts);f.includes(u)||(r=w("NON_CONFORMING_NAMESPACES",`${n} namespaces accounts don't satisfy namespace accounts for ${u}
        Required: ${u}
        Approved: ${f.toString()}`))}),a.forEach(u=>{r||(R(o[u].methods,s[u].methods)?R(o[u].events,s[u].events)||(r=w("NON_CONFORMING_NAMESPACES",`${n} namespaces events don't satisfy namespace events for ${u}`)):r=w("NON_CONFORMING_NAMESPACES",`${n} namespaces methods don't satisfy namespace methods for ${u}`))}),r}function zr(e){const t={};return Object.keys(e).forEach(n=>{var r;n.includes(":")?t[n]=e[n]:(r=e[n].chains)==null||r.forEach(o=>{t[o]={methods:e[n].methods,events:e[n].events}})}),t}function kt(e){return[...new Set(e.map(t=>t.includes(":")?t.split(":")[0]:t))]}function Yr(e){const t={};return Object.keys(e).forEach(n=>{if(n.includes(":"))t[n]=e[n];else{const r=U(e[n].accounts);r?.forEach(o=>{t[o]={accounts:e[n].accounts.filter(s=>s.includes(`${o}:`)),methods:e[n].methods,events:e[n].events}})}}),t}function Gr(e,t){return ee(e,!1)&&e<=t.max&&e>=t.min}function Qr(){const e=j();return new Promise(t=>{switch(e){case y.browser:t(xt());break;case y.reactNative:t(Mt());break;case y.node:t(Lt());break;default:t(!0)}})}function xt(){return M()&&navigator?.onLine}async function Mt(){if(O()&&typeof global<"u"&&global!=null&&global.NetInfo){const e=await(global==null?void 0:global.NetInfo.fetch());return e?.isConnected}return!0}function Lt(){return!0}function Zr(e){switch(j()){case y.browser:Ft(e);break;case y.reactNative:Kt(e);break;case y.node:break}}function Ft(e){!O()&&M()&&(window.addEventListener("online",()=>e(!0)),window.addEventListener("offline",()=>e(!1)))}function Kt(e){O()&&typeof global<"u"&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(t=>e(t?.isConnected))}const Oe={};class Xr{static get(t){return Oe[t]}static set(t,n){Oe[t]=n}static delete(t){delete Oe[t]}}exports.BASE10=me,exports.BASE16=v,exports.BASE64=ge,exports.BASE64URL=er,exports.COLON=an,exports.DEFAULT_DEPTH=oe,exports.EMPTY_SPACE=z,exports.ENV_MAP=y,exports.INTERNAL_ERRORS=At,exports.MemoryStore=Xr,exports.ONE_THOUSAND=cn,exports.REACT_NATIVE_PRODUCT=Ue,exports.RELAYER_DEFAULT_PROTOCOL=gt,exports.SDK_ERRORS=Tt,exports.SDK_TYPE=De,exports.SLASH=_e,exports.TYPE_0=he,exports.TYPE_1=k,exports.TYPE_2=L,exports.UTF8=V,exports.addResourceToRecap=ut,exports.appendToQueryString=Ve,exports.assertType=hn,exports.assignAbilityToActions=de,exports.base64Decode=at,exports.base64Encode=it,exports.buildApprovedNamespaces=Cr,exports.buildAuthObject=Jn,exports.buildNamespacesFromAuth=jr,exports.buildRecapStatement=dt,exports.calcExpiry=In,exports.capitalize=Sn,exports.capitalizeWord=Ke,exports.createDelayedPromise=wn,exports.createEncodedRecap=Gn,exports.createExpiringPromise=On,exports.createRecap=ct,exports.decodeRecap=T,exports.decodeTypeByte=$,exports.decodeTypeTwoEnvelope=lr,exports.decrypt=ur,exports.deriveSymKey=or,exports.deserialize=Z,exports.encodeRecap=G,exports.encodeTypeByte=ve,exports.encodeTypeTwoEnvelope=cr,exports.encrypt=ar,exports.engineEvent=Cn,exports.enumify=Nn,exports.formatAccountId=Pe,exports.formatAccountWithChain=tn,exports.formatChainId=Ie,exports.formatDeeplinkUrl=qe,exports.formatExpirerTarget=ie,exports.formatIdTarget=Tn,exports.formatMessage=nt,exports.formatMessageContext=yn,exports.formatRelayParams=vt,exports.formatRelayRpcUrl=mn,exports.formatStatementFromRecap=fe,exports.formatTopicTarget=Rn,exports.formatUA=Me,exports.formatUri=br,exports.fromBase64=ce,exports.generateKeyPair=nr,exports.generateRandomBytes32=rr,exports.getAccountsChains=U,exports.getAccountsFromNamespaces=rn,exports.getAddressFromAccount=Ce,exports.getAddressesFromAccounts=nn,exports.getAppId=dn,exports.getAppMetadata=pn,exports.getBrowserOnlineStatus=xt,exports.getChainFromAccount=je,exports.getChainsFromAccounts=$e,exports.getChainsFromNamespace=W,exports.getChainsFromNamespaces=on,exports.getChainsFromRecap=Xn,exports.getChainsFromRequiredNamespaces=sn,exports.getCommonValuesInArrays=ae,exports.getCryptoKeyFromKeyData=mt,exports.getDecodedRecapFromResources=rt,exports.getDeepLink=$n,exports.getDidAddress=le,exports.getDidAddressSegments=Y,exports.getDidChainId=et,exports.getEnvironment=j,exports.getHttpUrl=gn,exports.getInternalError=w,exports.getJavascriptID=xe,exports.getJavascriptOS=ke,exports.getLastItems=Fe,exports.getLinkModeURL=Nr,exports.getMethodsFromRecap=Zn,exports.getNamespacedDidChainId=tt,exports.getNamespacesChains=Nt,exports.getNamespacesEventsForChainId=wt,exports.getNamespacesFromAccounts=Rt,exports.getNamespacesMethodsForChainId=St,exports.getNodeOnlineStatus=Lt,exports.getReCapActions=st,exports.getReactNativeOnlineStatus=Mt,exports.getRecapAbilitiesFromResource=Yn,exports.getRecapFromResources=Q,exports.getRecapResource=ot,exports.getRelayClientMetadata=fn,exports.getRelayProtocolApi=vr,exports.getRelayProtocolName=yr,exports.getRequiredNamespacesFromNamespaces=Pr,exports.getSdkError=_,exports.getSearchParamFromURL=Un,exports.getUniqueValues=re,exports.handleDeeplinkRedirect=jn,exports.hasOverlap=R,exports.hashKey=sr,exports.hashMessage=ir,exports.isAndroid=un,exports.isBrowser=M,exports.isCaipNamespace=be,exports.isConformingNamespaces=Vt,exports.isExpired=Pn,exports.isIframe=Je,exports.isIos=ln,exports.isNode=se,exports.isOnline=Qr,exports.isProposalStruct=_r,exports.isReactNative=O,exports.isRecap=pe,exports.isSessionCompatible=$r,exports.isSessionStruct=Dr,exports.isTelegram=He,exports.isTestRun=Dn,exports.isTypeOneEnvelope=pr,exports.isTypeTwoEnvelope=fr,exports.isUndefined=A,exports.isValidAccountId=It,exports.isValidAccounts=jt,exports.isValidActions=Ut,exports.isValidArray=K,exports.isValidChainId=q,exports.isValidChains=Pt,exports.isValidController=Vr,exports.isValidEip1271Signature=Ge,exports.isValidEip191Signature=Ye,exports.isValidErrorReason=Fr,exports.isValidEvent=Br,exports.isValidId=Mr,exports.isValidNamespaceAccounts=$t,exports.isValidNamespaceActions=we,exports.isValidNamespaceChains=Ct,exports.isValidNamespaceMethodsOrEvents=Se,exports.isValidNamespaces=_t,exports.isValidNamespacesChainId=Hr,exports.isValidNamespacesEvent=Wr,exports.isValidNamespacesRequest=Jr,exports.isValidNumber=ee,exports.isValidObject=X,exports.isValidParams=Lr,exports.isValidRecap=N,exports.isValidRelay=Dt,exports.isValidRelays=xr,exports.isValidRequest=Kr,exports.isValidRequestExpiry=Gr,exports.isValidRequiredNamespaces=kr,exports.isValidResponse=qr,exports.isValidString=E,exports.isValidUrl=Ur,exports.mapEntries=bn,exports.mapToObj=vn,exports.mergeArrays=S,exports.mergeEncodedRecaps=Qn,exports.mergeRecaps=lt,exports.normalizeNamespaces=Ne,exports.objToMap=En,exports.openDeeplink=Be,exports.parseAccountId=ne,exports.parseChainId=te,exports.parseContextNames=Le,exports.parseExpirerTarget=An,exports.parseNamespaceKey=Ot,exports.parseRelayParams=ht,exports.parseTopic=yt,exports.parseUri=Er,exports.populateAuthPayload=Wn,exports.recapHasResource=zn,exports.serialize=Ee,exports.sleep=Vn,exports.subscribeToBrowserNetworkChange=Ft,exports.subscribeToNetworkChange=Zr,exports.subscribeToReactNativeNetworkChange=Kt,exports.toBase64=We,exports.uuidv4=_n,exports.validateDecoding=dr,exports.validateEncoding=ft,exports.validateSignedCacao=Hn,exports.verifyP256Jwt=hr,exports.verifySignature=ze;
//# sourceMappingURL=index.cjs.js.map
